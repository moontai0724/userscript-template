# UserScript Template

An out-of-the-box template simplifying userscript development with auto-rebuilds
on file changes, seamless WebDAV integration for extension syncing, semantic
commit-based versioning, and a robust CI/CD pipeline for automated releases.

## Usage

### Start the dev server

To start a development WebDAV server and auto rebuild the script on file
changes, run:

```bash
pnpm dev
```

There are some environment variables you can use to customize the dev server:

- `PORT`: The port of fake WebDAV server, default is `9000`.
- `HOST`: The host of fake WebDAV server, default is `0.0.0.0`.
- `UUID`: The uuid of the scipt. This will force the script to use this UUID
  instead of detected or generated one. If not set, it will be a default value
  "12345678-1234-1234-123456789012", and it will be auto updated by matching the
  title of the script with the `name` got from `package.json` when the extension
  sync.
- `DEBUG`: Enable debug mode, default is `false`.

For example, if you want to change the port to `8080`, you can run:

```bash
PORT=8080 pnpm dev
```

### Build the script

```bash
pnpm build
```

The built script will be in `dist` folder.

## Sync with extension

There are two way to setup the sync, one is using the WebDAV sync feature
provided by extension.

### Sync with fake WebDAV by extension

#### 1. First, start dev server by running

```bash
pnpm dev
```

#### 2. Install the script to extension

After you start the dev server, you can install the script to extension.

The console output should hint you the link to install the script like this:

```bash
WebDAV server is listening on http://0.0.0.0:9000
You can install current script from: http://0.0.0.0:9000/Tampermonkey/sync/12345678-1234-1234-123456789012.user.js
```

Or if this is the first time you start this dev server, you should be able to
install the script from the link below:

http://localhost:9000/Tampermonkey/sync/12345678-1234-1234-123456789012.user.js

#### 3. Setup WebDAV sync in extension

Then you can setup the WebDAV sync in extension.

For Tampermonkey, you can follow the steps below:

1. Go to `Tampermonkey > Settings > General > Config Mode` and set as
   `Advanced`.
2. Fill `URL` in `Userscript Sync` with `http://localhost:8080/`.
3. Check `Enable Userscript Sync` in `Userscript Sync`.
4. Click `Save`.

Then you can click the "Run now" button to start sync.

## FAQ

### How to get the script's UUID?

The script's UUID is generated by your extension when you install the script. So
you have to install the script first, then you can find the UUID.

To find the UUID, you can click the script and open the built-in editor, then
you'll see the UUID in the URL.

e.g.
`chrome-extension://dhdgffkkebhmkfjojejmpbldmpobfkfo/options.html#nav=ac6c73b7-55ec-446e-884c-7cab2087278c+editor`

For example above, `ac6c73b7-55ec-446e-884c-7cab2087278c` is the UUID.
